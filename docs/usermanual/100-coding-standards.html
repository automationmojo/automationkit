<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coding Standards and Patterns &mdash; Automation Kit 0.2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="akit" href="../apidoc/modules.html" />
    <link rel="prev" title="Code Organization" href="90-code-organization-and-conventions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Automation Kit
          </a>
              <div class="version">
                0.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="usermanual.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="10-design-and-architecture-overview.html">Design and Architectural Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="20-getting-started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="30-automation-configuration.html">Automation Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="31-landscape-file.html">Landscape File</a></li>
<li class="toctree-l2"><a class="reference internal" href="32-topology-file.html">Topology File</a></li>
<li class="toctree-l2"><a class="reference internal" href="33-runtime-file.html">Runtime File</a></li>
<li class="toctree-l2"><a class="reference internal" href="34-credentials-file.html">Credentials File</a></li>
<li class="toctree-l2"><a class="reference internal" href="40-testrun-sequencing.html">Test Run Sequencing</a></li>
<li class="toctree-l2"><a class="reference internal" href="41-integration-couplings.html">Integration Couplings</a></li>
<li class="toctree-l2"><a class="reference internal" href="42-scope-couplings.html">Scope Couplings</a></li>
<li class="toctree-l2"><a class="reference internal" href="50-functional-description.html">Functional Descriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="51-activation-and-startup.html">Activation and Startup</a></li>
<li class="toctree-l2"><a class="reference internal" href="52-inter-operability.html">Inter-Operability</a></li>
<li class="toctree-l2"><a class="reference internal" href="53-ssh-coordinator-and-agent.html">SSH Coordinator and Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="54-upnp-coordinator-and-agent.html">UPNP Coordinator and Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="60-workflow-orchestration.html">Workflow Orchestration</a></li>
<li class="toctree-l2"><a class="reference internal" href="70-enterprise-extensibility.html">Enterprise Extensibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="80-command-line.html">Command-Line</a></li>
<li class="toctree-l2"><a class="reference internal" href="90-code-organization-and-conventions.html">Code Organization</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Coding Standards and Patterns</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sections">Sections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#class-variable-initialization">Class Variable Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-optimization">Code Optimization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#one-liners-and-brevity-shortcuts">One Liners and Brevity Shortcuts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nested-inlining-function-calls">Nested Inlining Function Calls</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compound-return-statements">Compound Return Statements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multiline-error-message-formation">Multiline Error Message Formation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stable-property-implementations">Stable Property Implementations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dont-run-commands-via-ssh">Dont Run Commands Via SSH</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dont-call-methods-that-proxy-across-threads">Dont Call Methods that Proxy Across Threads</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#return-statements">Return Statements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#formation-of-appended-functionality">Formation of Appended Functionality</a></li>
<li class="toctree-l4"><a class="reference internal" href="#line-number-for-debugging">Line Number for Debugging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#in-context-return-verification">In Context Return Verification</a></li>
<li class="toctree-l4"><a class="reference internal" href="#code-legibility">Code Legibility</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#interop-and-persistance-decorators">InterOp and Persistance Decorators</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/modules.html">akit</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Automation Kit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="usermanual.html">User Manual</a> &raquo;</li>
      <li>Coding Standards and Patterns</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/usermanual/100-coding-standards.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="coding-standards-and-patterns">
<h1>Coding Standards and Patterns<a class="headerlink" href="#coding-standards-and-patterns" title="Permalink to this headline"></a></h1>
<p><strong>in-progress</strong></p>
<div class="section" id="sections">
<h2>Sections<a class="headerlink" href="#sections" title="Permalink to this headline"></a></h2>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#class-variable-initialization">Class Variable Initialization</a></p></li>
<li><p><a class="reference internal" href="#code-optimization">Code Optimization</a></p></li>
<li><p><a class="reference internal" href="#multiline-error-message-formation">Multiline Error Message Formation</a></p></li>
<li><p><a class="reference internal" href="#return-statements">Return Statements</a></p></li>
<li><p><a class="reference internal" href="#interop-and-persistance-decorators">InterOp and Persistance Decorators</a></p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="class-variable-initialization">
<h2>Class Variable Initialization<a class="headerlink" href="#class-variable-initialization" title="Permalink to this headline"></a></h2>
<p>All variables must be initialized in the constructor of the class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Blah</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">set_to_blah</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="s2">&quot;blahblah&quot;</span>
</pre></div>
</div>
<p>This is very important for visual debuggers and tools to perform type
inferencing and popup context menues when typing and help.  The tools will
inspect the constructor to see what variables are attached to <strong>self</strong>.
It also ensures that an initial value is present any time a variable is used.
The following is <strong>NOT</strong> allowed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Blah</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">set_to_blah</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="s2">&quot;blahblah&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="code-optimization">
<h2>Code Optimization<a class="headerlink" href="#code-optimization" title="Permalink to this headline"></a></h2>
<p>The desired characteristics of test code is different than that of production
code.  Test code is often used to debug or step through scenarios and workflows
in order to capture information about what is going on in the code that is the
target of the tests.  Because test code is used so often in the debugger to
perform investigations of product bugs and test issues, test code should only
be optimized where there is sufficient data to show that a specific area of code
is having a big negative impact on the performance of the test runs.</p>
<p>The reality of distributed automation frameworks is that they spend alot of
time in interop APIs looping on retry attempts with delays intentionally
inserted between retries.  Code that is intentionally being delayed should
<strong>NOT</strong> be the target of code optimizations.  The following is a list of
optimization techniques that are discouraged in the test code so the test code
can exhibit more of the desired characteristics list above.</p>
<ul class="simple">
<li><p>One Liners or Excessive Brevity</p></li>
<li><p>Nested Inlining Function Calls</p></li>
<li><p>Compound return statements</p></li>
</ul>
<p>I cannot stress enough that if poor test coding styles are used too much in a
large code base and if the practices go on for too long.  The code will be
difficult to work in and the productivity of the consumers of the test code
will be greatly impacted.</p>
<div class="section" id="one-liners-and-brevity-shortcuts">
<h3>One Liners and Brevity Shortcuts<a class="headerlink" href="#one-liners-and-brevity-shortcuts" title="Permalink to this headline"></a></h3>
<p>One liners and code written with the intent of being brief are not allowed and
or discourage in the automation code.  This is because ensuring the automation
code can be easily run and stepped through in the debugger is a primary requirement.
Simple list comprehensions that get assigned to a local variable are ok such as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dev_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">dev</span> <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">device_list</span> <span class="p">]</span>
</pre></div>
</div>
<p>These are acceptable because you can easily see the result of the list comprehension
in the debugger after the comprehension has run.  However, if the list comprehension
becomes more complexed with if statements calling functions, then you should
break out the list creation into mutliple lines like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dev_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">device_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">dev</span><span class="o">.</span><span class="n">deviceType</span> <span class="o">==</span> <span class="s1">&#39;network/upnp&#39;</span><span class="p">:</span>
        <span class="n">dev_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
</pre></div>
</div>
<p>This is most likely a little less performant. Squeezing every last bit of performance
out of the code is <strong>NOT</strong> a priority of creating test code that is easy to
consume, maintainable and easy to debug.</p>
</div>
<div class="section" id="nested-inlining-function-calls">
<h3>Nested Inlining Function Calls<a class="headerlink" href="#nested-inlining-function-calls" title="Permalink to this headline"></a></h3>
<p>An important aspect of code that is friendly to debug is that it spreads out
statements across multiple lines of code.  By spreading out code statement such
as function calls or index accesses across mutliple lines, we attach metadata in
the form of a line number to the statements which enables the debugger to work
more efficiently with the statements.</p>
<p>The following code is not debugger friendly or efficient because the statements
do not have unique line numbers associated with them in the python byte code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">some_function</span><span class="p">(</span><span class="n">param_function_a</span><span class="p">(),</span> <span class="n">param_function_b</span><span class="p">(),</span> <span class="n">param_function_c</span><span class="p">())</span>
</pre></div>
</div>
<p>Another thing to keep in mind is that indexers in python are actually function calls
so statements like the ones below are also undesired in test code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">some_function</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<p>A better way to get data items from a sequence or list would be to expand the sequence
to variables like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">data</span>
<span class="n">some_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="compound-return-statements">
<h3>Compound Return Statements<a class="headerlink" href="#compound-return-statements" title="Permalink to this headline"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">some_function</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">inner_function_call</span><span class="p">(</span><span class="n">inner_a</span><span class="p">(),</span> <span class="n">inner_b</span><span class="p">(),</span> <span class="n">inner_c</span><span class="p">(),</span> <span class="n">inner_d</span><span class="p">())</span>
</pre></div>
</div>
<p>For more details about how returns should be written, see the <a class="reference internal" href="#return-statements">Return Statements</a> section.</p>
</div>
</div>
<div class="section" id="multiline-error-message-formation">
<h2>Multiline Error Message Formation<a class="headerlink" href="#multiline-error-message-formation" title="Permalink to this headline"></a></h2>
<p>An important part of creating great automation frameworks and tools is the sharing of
expert knowledge between consumers of the automation framework code base.  A great way
to implement knowledge sharing is to write code so that it provides detailed contextual
information when errors occur.  This is important because the last person working or dealing
with an issue in the error handling code is working on the problem and has the best
knowledge about the context when the error occurs and should share that knowledge with others.</p>
<p>As part of providing well formed and detailed error reporting, we want to be able to see
and debug the code that is creating the error messages.  When creating multi-line error
messages, the following method is preferred.</p>
<ul class="simple">
<li><p>Create a list to hold the error message lines</p></li>
<li><p>Iterate any data collections or collect data and append lines to the list</p></li>
<li><p>Create section headers for individual data sections</p></li>
<li><p>Join the list of error message lines together using os.linesep.join() and assign the
message to a variable so it can be seen in the debugger</p></li>
<li><p>pass the error message variable to the exception</p></li>
</ul>
<p>The code below provides an example of the building of a detailed error message that is easy to debug.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">err_msg_lines</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Failed to find expected UPNP devices after a timeout of </span><span class="si">{}</span><span class="s2"> seconds.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response_timeout</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">err_msg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;EXPECTED: (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected_devices</span><span class="p">)</span> <span class="p">))</span>
<span class="k">for</span> <span class="n">dkey</span> <span class="ow">in</span> <span class="n">expected_devices</span><span class="p">:</span>
    <span class="n">err_msg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    </span><span class="si">{}</span><span class="s2">:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dkey</span><span class="p">))</span>
<span class="n">err_msg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">err_msg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;MATCHING: (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">scan_context</span><span class="o">.</span><span class="n">matching_devices</span><span class="p">)</span> <span class="p">))</span>
<span class="k">for</span> <span class="n">dkey</span> <span class="ow">in</span> <span class="n">scan_context</span><span class="o">.</span><span class="n">matching_devices</span><span class="p">:</span>
    <span class="n">err_msg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    </span><span class="si">{}</span><span class="s2">:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dkey</span><span class="p">))</span>
<span class="n">err_msg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">err_msg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FOUND: (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">scan_context</span><span class="o">.</span><span class="n">found_devices</span><span class="p">)</span> <span class="p">))</span>
<span class="k">for</span> <span class="n">dkey</span> <span class="ow">in</span> <span class="n">scan_context</span><span class="o">.</span><span class="n">found_devices</span><span class="p">:</span>
    <span class="n">err_msg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    </span><span class="si">{}</span><span class="s2">:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dkey</span><span class="p">))</span>
<span class="n">err_msg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">err_msg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;MISSING: (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span> <span class="p">))</span>
<span class="k">for</span> <span class="n">dkey</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">:</span>
    <span class="n">err_msg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    </span><span class="si">{}</span><span class="s2">:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dkey</span><span class="p">))</span>
<span class="n">err_msg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">err_msg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">err_msg_lines</span><span class="p">)</span>
<span class="k">raise</span> <span class="n">AKitTimeoutError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
</pre></div>
</div>
</div>
<div class="section" id="stable-property-implementations">
<h2>Stable Property Implementations<a class="headerlink" href="#stable-property-implementations" title="Permalink to this headline"></a></h2>
<p>Alot of engineers like to do fancy things with properties and they often think that its ok
to do whatever they want with properties and get as fancy as they want.  The proper use of
property is to provide controlled access to the data members of a class.  The developement
tools that we utilize, such as Visual Studo Code, are written with this implied behavioral
contract in mind on how properties should behave.</p>
<p>The reality is that when we as developers break this implied contract on property behavior,
we actually cause alot of problems for consumers of our code.  That is because visual
debuggers actually rely on this implied behavior in order to provide contextual information
to the software engineer when they are running code in debug sessions.  Look at the example
code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Blah</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span>

    <span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span>

    <span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span>
        <span class="k">return</span> <span class="n">val</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">blah</span> <span class="o">=</span> <span class="n">Blah</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;blah&quot;</span><span class="p">)</span>   <span class="c1"># Put Breakpoint Here</span>
</pre></div>
</div>
<p>When we run the code above in the debugger, we can see how the debugger responds to the code. By
inserting a breakpoint after on the <cite>print(“blah”)</cite>, we can pause in the debugger and see how the
debugger utilized the properties that are on the instance of object <cite>Blah</cite>.</p>
<img alt="_static/images/vscode-property-previews-for-blah.png" src="_static/images/vscode-property-previews-for-blah.png" />
<p>You can see from the image above that the debugger utilizes the implied contract with properties and
that they are simple accessors to internal property data. The debugger runs the code in the
property so it can show us a preview of the result.  This is shown by the fact that the ‘c’ property
is showing us the result of adding <cite>self._a + self._b</cite> and showing a value of <cite>3</cite> in the debugger
variables view.</p>
<p>This example hints at something that developers writing python code need to rememeber. Python is a
dynamic language.  Debuggers for dynamic languages cannot make the same assumptions that a debugger might
be able to make for a compiled language such as C or C++.  Compiled languages store data in memory
addresses and the variables get data directly from memory in those langauges.  In python, objects
can change dynamically and there is no way for the debugger to know from one statement to the next
if a property on an object still exists.  The debugger has to run the python code in a debug context
in the python process so it can debug the code.  It updates the debugger information by dynamically
calling python properties and operators in order to resolve the values of the variables, objects and thier
associated properties inside the debug execution context.  This dynamic evaluation of python code in context
is what make it possible to run commands in the interactive python console while debugging. From the
debugger image above you see the debugger presents us with a single thread and callstack, but if we attach
to the process in gdb we would see multiple threads.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(gdb) info threads
Id   Target Id                                  Frame
* 1    Thread 0x7f96d066c740 (LWP 51543) &quot;python&quot; futex_abstimed_wait_cancelable (private=0, abstime=0x0, clockid=0, expected=0, futex_word=0x1fd1250)
    at ../sysdeps/nptl/futex-internal.h:320
  2    Thread 0x7f96ceed0700 (LWP 51550) &quot;python&quot; 0x00007f96d0828618 in futex_abstimed_wait_cancelable (private=0, abstime=0x7f96ceecf110, clockid=0,
    expected=0, futex_word=0x7f96c80018e0) at ../sysdeps/nptl/futex-internal.h:320
  3    Thread 0x7f96ce6cf700 (LWP 51552) &quot;python&quot; __libc_recv (flags=&lt;optimized out&gt;, len=1024, buf=0x7f96c000e0c0, fd=3) at ../sysdeps/unix/sysv/linux/recv.c:28
  4    Thread 0x7f96cdece700 (LWP 51554) &quot;python&quot; futex_abstimed_wait_cancelable (private=0, abstime=0x0, clockid=0, expected=0, futex_word=0x7f96c40011f0)
    at ../sysdeps/nptl/futex-internal.h:320
  5    Thread 0x7f96cd6cd700 (LWP 51555) &quot;python&quot; 0x00007f96d0828618 in futex_abstimed_wait_cancelable (private=0, abstime=0x7f96cd6cc110, clockid=0,
    expected=0, futex_word=0x7f96b8001910) at ../sysdeps/nptl/futex-internal.h:320
  6    Thread 0x7f96ccecc700 (LWP 51556) &quot;python&quot; 0x00007f96d0828618 in futex_abstimed_wait_cancelable (private=0, abstime=0x7f96ccecb000, clockid=0,
    expected=0, futex_word=0x7f96bc001690) at ../sysdeps/nptl/futex-internal.h:32
</pre></div>
</div>
<p>In order to show what happens if we get too fancy with properties, lets modify the property code above so that
it blocks on a synchronization primitive.  We setup the <cite>c</cite> property to intentionally block on an event gate that
is clear and never going to be set.</p>
<img alt="../_images/vscode-property-preview-lockup.png" src="../_images/vscode-property-preview-lockup.png" />
<p>This demonstrates what will happen to our debug sessions if we attempt to get fancy and utilize a property for
performing a complicated operation. The debugger locks up and our debug session becomes frozen.  You can see this
by looking at the image above.  You can see that next to the <cite>blah</cite> object we get a <em>spinner</em> in the UI.  If we
attempt to step to the next statement, there is no response because the debugger is hung.  Lets look at the stack
trace of the thread that is hung in <strong>gdb</strong>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(gdb) py-bt
Traceback (most recent call first):
  File &quot;/usr/lib/python3.8/threading.py&quot;, line 302, in wait
    waiter.acquire()
  File &quot;/usr/lib/python3.8/threading.py&quot;, line 558, in wait
    signaled = self._cond.wait(timeout)
  File &quot;/home/myron/source/akit-quickstart/automation/python3/examples/blah.py&quot;, line 21, in c
    self._c.wait()
  &lt;built-in method getattr of module object at remote 0x7f96d008b0e0&gt;
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_resolver.py&quot;, line 193, in _get_py_dictionary
    attr = getattr(var, name)
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_resolver.py&quot;, line 74, in get_contents_debug_adapter_protocol
    dct, used___dict__ = self._get_py_dictionary(obj)
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_suspended_frames.py&quot;, line 166, in get_children_variables
    lst = resolver.get_contents_debug_adapter_protocol(self.value, fmt=fmt)
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_constants.py&quot;, line 513, in new_func
    return func(*args, **kwargs)
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_comm.py&quot;, line 775, in internal_get_variable_json
    for child_var in variable.get_children_variables(fmt=fmt, scope=scope):
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_constants.py&quot;, line 513, in new_func
    return func(*args, **kwargs)
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_comm.py&quot;, line 542, in do_it
    self.method(dbg, *self.args, **self.kwargs)
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/_vendored/pydevd/pydevd.py&quot;, line 1715, in process_internal_commands
    int_cmd.do_it(self)
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/_vendored/pydevd/pydevd.py&quot;, line 2010, in _do_wait_suspend
    self.process_internal_commands()
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/_vendored/pydevd/pydevd.py&quot;, line 2744, in do_wait_suspend

  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_frame.py&quot;, line 164, in do_wait_suspend
    self._args[0].do_wait_suspend(*args, **kwargs)
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/_vendored/pydevd/_pydevd_bundle/pydevd_frame.py&quot;, line 6321, in trace_dispatch
  File &quot;/home/myron/source/akit-quickstart/automation/python3/examples/blah.py&quot;, line 26, in &lt;module&gt;
    print(&quot;blah a={}&quot;.format(blah.a))   # Put Breakpoint Here
  &lt;built-in method exec of module object at remote 0x7f96d008b0e0&gt;
  File &quot;/usr/lib/python3.8/runpy.py&quot;, line 343, in _run_code
  File &quot;/usr/lib/python3.8/runpy.py&quot;, line 353, in _run_module_code
  File &quot;/usr/lib/python3.8/runpy.py&quot;, line 521, in run_path
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/../debugpy/server/cli.py&quot;, line 285, in run_file
    runpy.run_path(target_as_str, run_name=compat.force_str(&quot;__main__&quot;))
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/../debugpy/server/cli.py&quot;, line 1212, in main
  File &quot;/home/myron/.vscode/extensions/ms-python.python-2021.11.1422169775/pythonFiles/lib/python/debugpy/__main__.py&quot;, line 45, in &lt;module&gt;
    cli.main()
  &lt;built-in method exec of module object at remote 0x7f96d008b0e0&gt;
  File &quot;/usr/lib/python3.8/runpy.py&quot;, line 87, in _run_code
    exec(code, run_globals)
  File &quot;/usr/lib/python3.8/runpy.py&quot;, line 194, in _run_module_as_main
    return _run_code(code, main_globals, None,
</pre></div>
</div>
<p>What we can learn from this, is that its critical that our test code is debuggable and that we understand
how the debugger is executing our code.  In order to ensure that our test code can run in a stable fashion in the
debugger, we need to respect the implied contract that properties on objects should only be performing simple
calculations and internal object data access.  With that said, here are some specific examples of code that I have
encountered in properties that should be avoided.</p>
<div class="section" id="dont-run-commands-via-ssh">
<h3>Dont Run Commands Via SSH<a class="headerlink" href="#dont-run-commands-via-ssh" title="Permalink to this headline"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">todo_add_example</span><span class="p">():</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="section" id="dont-call-methods-that-proxy-across-threads">
<h3>Dont Call Methods that Proxy Across Threads<a class="headerlink" href="#dont-call-methods-that-proxy-across-threads" title="Permalink to this headline"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">todo_add_example</span><span class="p">():</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="return-statements">
<h2>Return Statements<a class="headerlink" href="#return-statements" title="Permalink to this headline"></a></h2>
<p>All functions or methods that are not generators should have a <cite>return</cite> statement.  The return
statements are important for four reasons:</p>
<ul class="simple">
<li><p>It prevents the formation of appended functionality during a bad code merge</p></li>
<li><p>It provides line number data for the debugger</p></li>
<li><p>It provides a way to check results, in context, before a return</p></li>
<li><p>It makes code easier to read</p></li>
</ul>
<p>Below is a detailed description of each of these issues.</p>
<div class="section" id="formation-of-appended-functionality">
<h3>Formation of Appended Functionality<a class="headerlink" href="#formation-of-appended-functionality" title="Permalink to this headline"></a></h3>
<p>One of the common tasks that is performed frequently by software developers is the refactoring or
merging of code.  During the process of refactoring or merging code, function declarations might
be missed or incorrectly deleted.  When this happens, new functionality can end up being inadvertantly
appended to the previous function in the code.  Take the following two functions as a simplified example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">say_hello</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">say_world</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If returns are not present at the end of the functions above, then during a refactor or code
merge, it is possible for lines of code to be removed, like if the <cite>say_world</cite> function
declaration was deleted like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">say_hello</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, without warning from python, the functionality of the <cite>say_world</cite> function has been appended
to the <cite>say_hello</cite> function and thus changes the functionality of the <cite>say_hello</cite> function without
warning.</p>
<p>Now lets look at what would happen if the same thing took place when return statements are utilized
as in the code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">say_hello</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">say_world</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
<p>In the code above, we clearly mark the end of our functions so python has a better chance of doing
the correct thing when code is modified incorrectly.  If the function declaration for <cite>say_world</cite>
is removed like so.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">say_hello</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
    <span class="k">return</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
<p>In the case above, python will not execute the dangling code and will not append its functionality
to the <cite>say_hello</cite> method.  Also, the python linter can show the remaining code body for <cite>say_world</cite>
as dead code or unreachable code and complain when it tries to lint the code in the file.</p>
</div>
<div class="section" id="line-number-for-debugging">
<h3>Line Number for Debugging<a class="headerlink" href="#line-number-for-debugging" title="Permalink to this headline"></a></h3>
<p>A very important aspect of test code is debuggability.  In order to be able to inspect the results
of a function before it returns, you need a line of code to hang a breakpoint on. By stopping the
debugger on the return statement, you can see the values of the inputs to the function and values
of any intermediate byproducts or local variables in the context of the function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dis</span>

<span class="k">def</span> <span class="nf">function_with_return</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">99</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Hello &#39;99&#39;&quot;</span><span class="p">)</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">function_without_return</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">99</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Hello &#39;99&#39;&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==== FUNCTION WITH RETURN ====&quot;</span><span class="p">)</span>
<span class="n">fwr_assem</span> <span class="o">=</span> <span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">function_with_return</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fwr_assem</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==== FUNCTION WITHOUT RETURN ====&quot;</span><span class="p">)</span>
<span class="n">fwor_assem</span> <span class="o">=</span> <span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">function_without_return</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fwor_assem</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>==== FUNCTION WITH RETURN ====
4           0 LOAD_FAST                0 (a)
            2 LOAD_FAST                1 (b)
            4 BINARY_ADD
            6 LOAD_CONST               1 (99)
            8 COMPARE_OP               2 (==)
            10 POP_JUMP_IF_FALSE       20

5          12 LOAD_GLOBAL              0 (print)
            14 LOAD_CONST               2 (&quot;Hello &#39;99&#39;&quot;)
            16 CALL_FUNCTION            1
            18 POP_TOP

6     &gt;&gt;   20 LOAD_CONST               0 (None)  # Has a Distict Line Number (6)
            22 RETURN_VALUE
None
</pre></div>
</div>
<p>Distinct lines of code, which have an associated line number, are very important for enabling a
great debugging experience.  Without a distinct line of code or line number, there is no place
to hang a breakpoint on a piece of code that is associated with the bytecode of a program.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>==== FUNCTION WITHOUT RETURN ====
9           0 LOAD_FAST                0 (a)
            2 LOAD_FAST                1 (b)
            4 BINARY_ADD
            6 LOAD_CONST               1 (99)
            8 COMPARE_OP               2 (==)
            10 POP_JUMP_IF_FALSE       20

10          12 LOAD_GLOBAL              0 (print)
            14 LOAD_CONST               2 (&quot;Hello &#39;99&#39;&quot;)
            16 CALL_FUNCTION            1
            18 POP_TOP
        &gt;&gt;   20 LOAD_CONST               0 (None)  # Has NO Line Number
            22 RETURN_VALUE
None
</pre></div>
</div>
</div>
<div class="section" id="in-context-return-verification">
<h3>In Context Return Verification<a class="headerlink" href="#in-context-return-verification" title="Permalink to this headline"></a></h3>
<p>One of the most important aspects of writing debuggable code, is to write code in such a way that
you can see the values of the local variables that contributed to the creation of the value being
returned.  The following is an example function that demonstrates the concept of writing functions
so the context of the return value can be examined.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">example_function</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>

    <span class="n">multiplier</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="n">rtnval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">multiplier</span>

    <span class="k">return</span> <span class="n">rtnval</span>
</pre></div>
</div>
<p>From looking at the simple example above, you can see that in order to debug the function and
make sure it is returning the correct answer, it is useful to be able to see the <cite>multiplier</cite>
parameter that is generated locally and is being used to effect the output.  Providing a simple
independant return allows us to see the context that is generating the output value.  Another
example below shows how a function like this might be written that will not provide the same
ability to debug the function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">example_function</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>This function is sometimes valued by some developers for its brevity, but for testing purposes,
this coding style results in reduced quality code. The reason the code is reduced quality is
because you cannot see the context of the return value being generated.  If you put a breakpoint
on the <cite>return</cite> statement, you don’t see the resulting value until you step out into the calling
function context. When you step out of the function to its calling function to see the return value,
the local variables of the <cite>example_function</cite> and the context that generated the return value is
no longer available. Upon the return of the function, the stack was popped and the context went away.</p>
<p>Because of the importance of examining the context that generates a returned value, it is always
prefered to create a local variable in order to effect a simple return like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">example_function</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">rtnval</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span>
    <span class="k">return</span> <span class="n">rtnval</span>
</pre></div>
</div>
<p>Vise a complexed return statement such as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">example_function</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span>
</pre></div>
</div>
</div>
<div class="section" id="code-legibility">
<h3>Code Legibility<a class="headerlink" href="#code-legibility" title="Permalink to this headline"></a></h3>
<p>Finally, <cite>return</cite> statements are important to improve the legibility of code. Because python code
uses indentation to determine scope, the repeated indentation of successive code blocks can present
issues with the readability of code. This can particularly be a problem with longer functions.  The
example code below demonstates the improvement of ligibility that a return statement can offer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">example_function</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">c</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
    <span class="n">val</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span>
    <span class="k">return</span>
</pre></div>
</div>
<p>For the code above, it is clear where the end of the function resides as it has a return.  This can
be particularly important if this was a longer function.</p>
<p>For the function below, it might be a little more confusing where a function ends in a larger block
of code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">example_function</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">c</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
    <span class="n">rtnval</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span>
</pre></div>
</div>
<p>For consistency and to help resolve all of these issues, It is prefered to use returns on all functions
and methods.  Any function or method that is not a generator, since generators don’t have returns.</p>
</div>
</div>
<div class="section" id="interop-and-persistance-decorators">
<h2>InterOp and Persistance Decorators<a class="headerlink" href="#interop-and-persistance-decorators" title="Permalink to this headline"></a></h2>
<p>Distributed automation scenarios engage in an aweful lot of interop activity.  When your engaging in
any type of interop activity, there can be problems with reliability.  One of the major aspects of
distrubuted testing is to place reliability expectations on the performance of interop APIS under
both success and failure conditions.  Let me highlight that, test framwork APIs <strong>must</strong> be useable by
test code for both <strong>success</strong> and <strong>failure</strong> conditions.  They must allow for the caller to pass
<strong>valid</strong> and <strong>invalid</strong> data so the behavior of the remote enpoint can be tested under different
conditions.</p>
<p>An experience Test Framework Architect is aware of this important aspect of test framework APIs that is
much different from maybe a production API and will design the APIs accordingly.</p>
<p>One pattern that you might see in a production environment for APIs is the use of a <cite>&#64;retry</cite> decorator
on an API that might not have 100% reliability.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@retry</span><span class="p">(</span><span class="n">attempts</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run_command</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssh_agent</span><span class="o">.</span><span class="n">run_cmd</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
<p>This might work fine in a production environment where calling the API successfully is the main goal,
but for test code, our main goal for interop APIs is not just to make a successful calls.  We also have
several competeing goals:</p>
<blockquote>
<div><ul class="simple">
<li><p>Check expected behavior (for success and failure)</p></li>
<li><p>Capture detailed data in failure contexts</p></li>
<li><p>Let tests and higher level code have control of behaviors and expectations</p></li>
</ul>
</div></blockquote>
<p>The use of retry decorations negatively impacts these goals.  First of all, a <cite>&#64;retry</cite> decoration always
assumes a call should succeed.  Good test framework code <strong>does not assume</strong> or make decisions for the
code that is controlling the flow of a test.  Flow control and error handling should be the responsibility
of the higher level test code.  Good test framework code lets the higher level code <strong>make expections</strong>
on the behavior of the code under test in varying conditions.  Good test framework code also allows
the higher level code to make decisions about behavior under success and failure conditions so the
higher level code can decide what to do based on the current context of the test.</p>
<p>Another problem with the use of the <cite>&#64;retry</cite> decorator is the fact that it will not be capable of changing
behavior based on use context as it is applied on module import and not at test runtime.  The test code
should be able to vary the parameters passed to test framework APIs and control the behavior and also how
the API collects data.</p>
<p>Below is another example of the use of a persistance decorator that will negatively impact the ability
of a test framework API to work with test code in order to test the interoperability of remote target
code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@reconnect_retry_method</span>
<span class="k">def</span> <span class="nf">run_command</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssh_agent</span><span class="o">.</span><span class="n">run_cmd</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span>
</pre></div>
</div>
<p>These uses of decorators don’t take into account the proper testing scenarios and limit diversity of
behavior for the API.  A better approach to design inter-operability APIs used by the <strong>Automation Kit</strong>
is to allow the tests to pass parameters to the API to allow higher level code to change the behavior of
the APIs.</p>
<p>The pattern that should be used is to tack on behavior modification parameters to the end of the
inter-op APIs.  Another important aspect of designing APIs and behavior parameters is to be consistent.
An example of a behavior paremeter might be that on every API that modifies the remote state shared by
devices should have a <cite>sync</cite> parameter to indicate the API should wait for a <cite>sync</cite> of shared state.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_member</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sync</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">id</span>

<span class="k">def</span> <span class="nf">delete_member</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sync</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">get_members</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">rename_member</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">new_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">old_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sync</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">return</span>
</pre></div>
</div>
<p>Note on the above API(s), the APIs that <cite>add</cite>, <cite>delete</cite> and <cite>modify</cite> data have a sync parameter and
the APIs that do not modify state do not offer a sync behavior.</p>
<p>This sort of adding parameters can be a problem when you have lots of different ways you want
to offer control over a set of interop API(s).  You can quickly have a longer list of parameters
that are needed to control the behavior of the lower level code.  If you have 500 interop APIs
in your test framework, this can lead to maintenance issues when adding new parameters.  The
<strong>Automation Kit</strong> deals with this nicely by have one Object parameter, that is used to contain
the behavior modification parameters.  Here is an example of a way to handle this that will scale
nicely.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Aspects</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Aspects are utilized with the interop APIs and agents such as the :class:`SSHAgent` class in order</span>
<span class="sd">        to modify the behavior of APIs with respect to retry parameter such as timeout, interval, looping patterns</span>
<span class="sd">        logging, etc.  The aspects object provides a way to package this common criteria into a single parameter</span>
<span class="sd">        or constant you can  pass to multiple APIs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_pattern</span><span class="p">:</span> <span class="n">ActionPattern</span> <span class="o">=</span> <span class="n">ActionPattern</span><span class="o">.</span><span class="n">SINGULAR</span><span class="p">,</span> <span class="n">completion_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_COMPLETION_TIMEOUT</span><span class="p">,</span> <span class="n">completion_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_COMPLETION_INTERVAL</span><span class="p">,</span>
                      <span class="n">inactivity_timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_INACTIVITY_TIMEOUT</span><span class="p">,</span> <span class="n">inactivity_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_INACTIVITY_INTERVAL</span><span class="p">,</span> <span class="n">monitor_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_MONITOR_DELAY</span><span class="p">,</span>
                      <span class="n">logging_pattern</span><span class="p">:</span> <span class="n">LoggingPattern</span> <span class="o">=</span> <span class="n">DEFAULT_LOGGING_PATTERN</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Logger&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Creates an :class:`Aspects` package.</span>

<span class="sd">            :param action_pattern: The :class:`ActionPattern` that the API should exhibit such as SINGULAR, DO_UNTIL_SUCCESS, DO_WHILE_SUCCESS</span>
<span class="sd">            :param completion_timeout: The time in seconds as a float that is the max time before timeout for the activity to complete.</span>
<span class="sd">            :param completion_interval: The time in seconds as a float that is waited before reattempting an activity.</span>
<span class="sd">            :param inactivity_timeout: The time in seconds as a float that is the max time before timeout that is waited before a :class:`TimeoutError`</span>
<span class="sd">                                      is raised due to inactivity.</span>
<span class="sd">            :param inactivity_interval: The time in seconds as a float that is waited before reattempting an activity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_pattern</span> <span class="o">=</span> <span class="n">action_pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completion_timeout</span> <span class="o">=</span> <span class="n">completion_timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completion_interval</span> <span class="o">=</span> <span class="n">completion_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inactivity_timeout</span> <span class="o">=</span> <span class="n">inactivity_timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inactivity_interval</span> <span class="o">=</span> <span class="n">inactivity_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitor_delay</span> <span class="o">=</span> <span class="n">monitor_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging_pattern</span> <span class="o">=</span> <span class="n">logging_pattern</span>

        <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">getAutomatonKitLogger</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

        <span class="k">return</span>
</pre></div>
</div>
<p>So for the example APIs above, we might add a single behavior parameter to all of the APIs to offer
the test code control of the behavior of the code making the remote interop REMOTE-API call.  For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_member</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sync</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">aspects</span><span class="p">:</span> <span class="n">Aspects</span><span class="o">=</span><span class="n">DEFAULT_ASPECTS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">id</span>

<span class="k">def</span> <span class="nf">delete_member</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sync</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">aspects</span><span class="p">:</span> <span class="n">Aspects</span><span class="o">=</span><span class="n">DEFAULT_ASPECTS</span><span class="p">):</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">get_members</span><span class="p">(</span><span class="n">aspects</span><span class="p">:</span> <span class="n">Aspects</span><span class="o">=</span><span class="n">DEFAULT_ASPECTS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">rename_member</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">new_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">old_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sync</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">aspects</span><span class="p">:</span> <span class="n">Aspects</span><span class="o">=</span><span class="n">DEFAULT_ASPECTS</span><span class="p">):</span>
    <span class="k">return</span>
</pre></div>
</div>
<p>Now lets say we need to add a new parameter to all 500 of our interop APIs, we don’t need to modify
any of the 500 API function signatures.  To add the new behavior control, we modify the <cite>Aspects</cite> object
and we modify the lower level remote interop REMOTE-API calling code. Our maintenance headache of modifying
all 500 APIs to add a new behavior is eliminated.</p>
<p>This pattern scales well and very very very important aspects of how we write code is that it
needs to be consumable, reliable and must be maintainable at scale.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="90-code-organization-and-conventions.html" class="btn btn-neutral float-left" title="Code Organization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../apidoc/modules.html" class="btn btn-neutral float-right" title="akit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Myron W. Walker.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>